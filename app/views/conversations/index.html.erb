<div class="cf ph2 ph5-ns pt3 mb2">
  <div class="fl w-30">
    <% unread_messages = 0 %>
    <% @conversations.each do |conversation| %>
      <% conversation.private_messages.each do |private_message| %>
        <% if private_message.user != current_user && private_message.read == false %>
          <% unread_messages += 1 %>
        <% end %>
      <% end %>
    <% end %>
    <h3 class="book-title f3 black lh-title fw9 mt0 pt1 pb3">Messages(<%= unread_messages %>)</h3>
    <div class="ui list">
      <% @conversations.each do |conversation| %>
        <% if conversation.sender_id == current_user.id || conversation.recipient_id == current_user.id %>
          <% if conversation.sender_id == current_user.id %>
            <% @recipient = User.find(conversation.recipient_id) %>
          <% else %>
            <% @recipient = User.find(conversation.sender_id) %>
          <% end %>
          <blockquote class="f7 ml0 mt0 pl2 bl bw2">
            <% avatar_url = @recipient.facebook_picture_url || @recipient.google_picture_url || "http://i.pravatar.cc/150?img=17" %>
            <%= image_tag avatar_url, class: "br-100 w2 dib" %>
            <%#= link_to @recipient.email, conversation_path(conversation) %>
            <%= link_to @recipient.email, read_conversation_path(conversation), method: :patch %>
            <% unread_messages = 0 %>
            <% conversation.private_messages.each do |private_message| %>
              <% if private_message.user != current_user && private_message.read == false %>
                <% unread_messages += 1 %>
              <% end %>
            <% end %>
            <p>Unread messages: <%= unread_messages %></p>
          </blockquote>
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="fl w-70">
    <%= render 'private_messages/index' %>
  </div>
</div>

